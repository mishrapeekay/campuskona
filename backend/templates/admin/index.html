{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrahead %}
{{ block.super }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* â”€â”€ Reset content area â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#content { padding: 0 !important; margin: 0 !important; }

/* â”€â”€ Root layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-wrap {
    background: #f1f5f9;
    min-height: calc(100vh - 100px);
    padding: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

/* â”€â”€ Compact top bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.65rem 1.5rem;
    {% if is_master_admin %}
    background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
    {% else %}
    background: linear-gradient(90deg, #059669 0%, #0891b2 100%);
    {% endif %}
    color: white;
}
.db-topbar-left { display: flex; align-items: center; gap: 0.75rem; }
.db-topbar-left i { font-size: 1.1rem; opacity: 0.85; }
.db-topbar-title { font-size: 1rem; font-weight: 700; letter-spacing: 0.01em; }
.db-topbar-sub { font-size: 0.72rem; opacity: 0.8; margin-top: 1px; }
.db-topbar-right { display: flex; align-items: center; gap: 1rem; font-size: 0.75rem; opacity: 0.9; }
.db-topbar-badge {
    background: rgba(255,255,255,0.2);
    padding: 0.2rem 0.65rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.7rem;
}

/* â”€â”€ Stat strip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0;
    background: white;
    border-bottom: 1px solid #e2e8f0;
}
.db-stat {
    display: flex;
    align-items: center;
    gap: 0.9rem;
    padding: 0.9rem 1.25rem;
    border-right: 1px solid #e2e8f0;
    transition: background 0.15s;
    text-decoration: none;
}
.db-stat:last-child { border-right: none; }
.db-stat:hover { background: #f8fafc; }
.db-stat-icon {
    width: 38px; height: 38px;
    border-radius: 9px;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.95rem;
    flex-shrink: 0;
}
.db-stat-icon.s1 { background: #ede9fe; color: #7c3aed; }
.db-stat-icon.s2 { background: #dbeafe; color: #2563eb; }
.db-stat-icon.s3 { background: #fef3c7; color: #d97706; }
.db-stat-icon.s4 { background: #dcfce7; color: #16a34a; }
.db-stat-icon.s5 { background: #fee2e2; color: #dc2626; }
.db-stat-icon.s6 { background: #e0f2fe; color: #0284c7; }
.db-stat-val { font-size: 1.45rem; font-weight: 800; color: #0f172a; line-height: 1; }
.db-stat-lbl { font-size: 0.68rem; font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; margin-top: 2px; }

/* â”€â”€ Main 2-column body â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-body {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 1rem;
    padding: 1rem 1.25rem 0.5rem;
    align-items: start;
}

/* â”€â”€ Card base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-card {
    background: white;
    border-radius: 10px;
    border: 1px solid #e2e8f0;
    overflow: hidden;
}
.db-card-hdr {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.65rem 1rem;
    border-bottom: 1px solid #f1f5f9;
    background: #fafafa;
}
.db-card-hdr h3 {
    margin: 0;
    font-size: 0.78rem;
    font-weight: 700;
    color: #374151;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    display: flex; align-items: center; gap: 0.45rem;
}
.db-card-hdr h3 i { color: #94a3b8; font-size: 0.72rem; }

/* â”€â”€ Quick Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
}
.db-action-btn {
    display: flex;
    align-items: center;
    gap: 0.6rem;
    padding: 0.7rem 1rem;
    text-decoration: none;
    color: #374151;
    font-size: 0.8rem;
    font-weight: 600;
    border-right: 1px solid #f1f5f9;
    border-bottom: 1px solid #f1f5f9;
    transition: all 0.15s;
}
.db-action-btn:hover { background: #f0fdf4; color: #059669; }
.db-action-btn i { width: 24px; height: 24px; border-radius: 6px; display:flex; align-items:center; justify-content:center; font-size:0.7rem; flex-shrink:0; }
.db-action-btn .ai-green { background: #dcfce7; color: #16a34a; }
.db-action-btn .ai-blue  { background: #dbeafe; color: #2563eb; }
.db-action-btn .ai-purple{ background: #ede9fe; color: #7c3aed; }
.db-action-btn .ai-amber { background: #fef3c7; color: #d97706; }
.db-action-btn .ai-red   { background: #fee2e2; color: #dc2626; }
.db-action-btn .ai-cyan  { background: #e0f2fe; color: #0284c7; }
.db-action-btn .ai-slate { background: #f1f5f9; color: #475569; }
.db-action-btn .ai-pink  { background: #fce7f3; color: #db2777; }

/* â”€â”€ Right column â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-right { display: flex; flex-direction: column; gap: 1rem; }

/* â”€â”€ Recent actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.act-list { list-style: none; padding: 0; margin: 0; }
.act-item {
    display: flex;
    align-items: flex-start;
    gap: 0.6rem;
    padding: 0.55rem 0.85rem;
    border-bottom: 1px solid #f8fafc;
}
.act-item:last-child { border-bottom: none; }
.act-icon {
    width: 24px; height: 24px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.6rem; flex-shrink: 0; margin-top: 1px;
}
.act-add  { background: #dcfce7; color: #16a34a; }
.act-chg  { background: #dbeafe; color: #2563eb; }
.act-del  { background: #fee2e2; color: #dc2626; }
.act-obj { font-size: 0.75rem; font-weight: 600; color: #1e293b; text-decoration: none; display: block; }
.act-obj:hover { color: #2563eb; }
.act-meta { font-size: 0.67rem; color: #94a3b8; margin-top: 1px; }

/* â”€â”€ School portals (master admin) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.portal-list { padding: 0.5rem 0; }
.portal-item {
    display: flex; align-items: center; gap: 0.6rem;
    padding: 0.5rem 0.85rem;
    border-bottom: 1px solid #f8fafc;
    text-decoration: none; color: #374151;
    transition: background 0.1s;
}
.portal-item:last-child { border-bottom: none; }
.portal-item:hover { background: #f0fdf4; }
.portal-dot { width: 8px; height: 8px; border-radius: 50%; background: #10b981; flex-shrink: 0; }
.portal-name { font-size: 0.78rem; font-weight: 600; flex: 1; }
.portal-schema { font-size: 0.65rem; color: #94a3b8; font-family: monospace; }
.portal-arrow { color: #cbd5e1; font-size: 0.65rem; }

/* â”€â”€ Tenant info chip â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-tenant-chip {
    display: inline-flex; align-items: center; gap: 0.4rem;
    font-size: 0.68rem; color: rgba(255,255,255,0.85);
}
.db-tenant-chip .chip-val { font-weight: 700; color: white; }

/* â”€â”€ Empty state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.db-empty { padding: 1.5rem; text-align: center; color: #94a3b8; font-size: 0.78rem; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FULL-WIDTH MODULES SECTION (below the 2-col body)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.db-modules-section {
    margin: 0 1.25rem 1rem;
}
.db-modules-section .db-card-hdr {
    border-radius: 10px 10px 0 0;
}

/* Module app grid: 3 columns on wide screens */
.db-mod-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0;
    background: white;
    border: 1px solid #e2e8f0;
    border-top: none;
    border-radius: 0 0 10px 10px;
    overflow: hidden;
}

/* Each app block */
.mod-app {
    border-right: 1px solid #f1f5f9;
    border-bottom: 1px solid #f1f5f9;
    padding: 0.6rem 0.85rem 0.55rem;
    background: white;
    transition: background 0.12s;
}
.mod-app:hover { background: #fafcff; }

/* App name row */
.mod-app-hdr {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    margin-bottom: 0.35rem;
}
.mod-app-name {
    font-size: 0.72rem;
    font-weight: 700;
    color: #1e293b;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    flex: 1;
}
.mod-app-name:hover { color: #2563eb; }
.mod-app-badge {
    font-size: 0.6rem;
    background: #e0f2fe;
    color: #0284c7;
    padding: 0.08rem 0.38rem;
    border-radius: 8px;
    font-weight: 700;
}

/* Model chips row */
.mod-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.3rem;
}
.mod-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.22rem;
    font-size: 0.68rem;
    color: #475569;
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    padding: 0.12rem 0.5rem;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.12s;
    white-space: nowrap;
}
.mod-chip:hover {
    background: #eff6ff;
    border-color: #bfdbfe;
    color: #1d4ed8;
}
.mod-chip-add {
    display: inline-flex;
    align-items: center;
    font-size: 0.58rem;
    color: #16a34a;
    background: #f0fdf4;
    border: 1px solid #bbf7d0;
    border-radius: 4px;
    padding: 0.12rem 0.38rem;
    text-decoration: none;
    font-weight: 700;
    transition: all 0.12s;
    white-space: nowrap;
}
.mod-chip-add:hover {
    background: #dcfce7;
    border-color: #86efac;
}

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 1100px) {
    .db-body { grid-template-columns: 1fr; }
    .db-right { flex-direction: row; flex-wrap: wrap; }
    .db-right .db-card { flex: 1; min-width: 280px; }
    .db-mod-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 700px) {
    .db-stats { grid-template-columns: repeat(2, 1fr); }
    .db-mod-grid { grid-template-columns: 1fr; }
}
</style>
{% endblock %}

{% block content %}
<div class="db-wrap">

{# â”€â”€ COMPACT TOP BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="db-topbar">
    <div class="db-topbar-left">
        {% if is_master_admin %}
        <i class="fas fa-shield-alt"></i>
        <div>
            <div class="db-topbar-title">CampusKona Platform Admin</div>
            <div class="db-topbar-sub">Global Control Center</div>
        </div>
        {% else %}
        <i class="fas fa-graduation-cap"></i>
        <div>
            <div class="db-topbar-title">{{ request.tenant.name }}</div>
            <div class="db-topbar-sub">School Administrator Â· {{ current_academic_year|default:"" }}</div>
        </div>
        {% endif %}
    </div>
    <div class="db-topbar-right">
        {% if not is_master_admin %}
        <span class="db-tenant-chip">
            Schema: <span class="chip-val">{{ request.tenant.schema_name }}</span>
        </span>
        <span class="db-tenant-chip">
            Domain: <span class="chip-val">{{ request.tenant.subdomain }}.campuskona.com</span>
        </span>
        {% else %}
        <span class="db-topbar-badge">{{ active_schools }} Active Schools</span>
        <span class="db-topbar-badge">{{ total_subscriptions }} Subscriptions</span>
        {% endif %}
    </div>
</div>

{# â”€â”€ STAT STRIP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="db-stats">
{% if is_master_admin %}
    <div class="db-stat">
        <div class="db-stat-icon s1"><i class="fas fa-school"></i></div>
        <div><div class="db-stat-val">{{ total_schools|default:"0" }}</div><div class="db-stat-lbl">Total Schools</div></div>
    </div>
    <div class="db-stat">
        <div class="db-stat-icon s2"><i class="fas fa-check-circle"></i></div>
        <div><div class="db-stat-val">{{ active_schools|default:"0" }}</div><div class="db-stat-lbl">Active</div></div>
    </div>
    <div class="db-stat">
        <div class="db-stat-icon s3"><i class="fas fa-file-invoice-dollar"></i></div>
        <div><div class="db-stat-val">{{ total_subscriptions|default:"0" }}</div><div class="db-stat-lbl">Subscriptions</div></div>
    </div>
    <div class="db-stat">
        <div class="db-stat-icon s4"><i class="fas fa-globe"></i></div>
        <div><div class="db-stat-val">{{ total_domains|default:"0" }}</div><div class="db-stat-lbl">Domains</div></div>
    </div>
{% else %}
    <div class="db-stat">
        <div class="db-stat-icon s1"><i class="fas fa-user-graduate"></i></div>
        <div><div class="db-stat-val">{{ total_students|default:"0" }}</div><div class="db-stat-lbl">Students</div></div>
    </div>
    <div class="db-stat">
        <div class="db-stat-icon s2"><i class="fas fa-user-tie"></i></div>
        <div><div class="db-stat-val">{{ total_staff|default:"0" }}</div><div class="db-stat-lbl">Staff</div></div>
    </div>
    <div class="db-stat">
        <div class="db-stat-icon s3"><i class="fas fa-chalkboard"></i></div>
        <div><div class="db-stat-val">{{ total_classes|default:"0" }}</div><div class="db-stat-lbl">Active Sections</div></div>
    </div>
    <div class="db-stat">
        <div class="db-stat-icon s4"><i class="fas fa-calendar-check"></i></div>
        <div><div class="db-stat-val">{{ attendance_percentage|default:"0" }}%</div><div class="db-stat-lbl">Attendance</div></div>
    </div>
{% endif %}
</div>

{# â”€â”€ 2-COLUMN BODY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ #}
<div class="db-body">

    {# LEFT: Quick Actions #}
    <div>
        <div class="db-card">
            <div class="db-card-hdr">
                <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
            </div>
            <div class="db-actions">
            {% if is_master_admin %}
                <a href="{% url 'admin:tenants_school_add' %}" class="db-action-btn">
                    <i class="ai-green fas fa-plus"></i> Add School</a>
                <a href="{% url 'admin:tenants_school_changelist' %}" class="db-action-btn">
                    <i class="ai-blue fas fa-list"></i> All Schools</a>
                <a href="{% url 'admin:tenants_subscription_changelist' %}" class="db-action-btn">
                    <i class="ai-amber fas fa-file-invoice-dollar"></i> Subscriptions</a>
                <a href="{% url 'admin:tenants_domain_changelist' %}" class="db-action-btn">
                    <i class="ai-purple fas fa-globe"></i> Domains</a>
                <a href="{% url 'admin:authentication_user_changelist' %}" class="db-action-btn">
                    <i class="ai-slate fas fa-users"></i> Users</a>
                <a href="{% url 'admin:partners_partner_changelist' %}" class="db-action-btn">
                    <i class="ai-cyan fas fa-handshake"></i> Partners</a>
            {% else %}
                <a href="{% url 'admin:students_student_add' %}" class="db-action-btn">
                    <i class="ai-green fas fa-user-plus"></i> Add Student</a>
                <a href="{% url 'admin:students_student_changelist' %}" class="db-action-btn">
                    <i class="ai-blue fas fa-users"></i> Students</a>
                <a href="{% url 'admin:staff_staffmember_add' %}" class="db-action-btn">
                    <i class="ai-purple fas fa-user-tie"></i> Add Staff</a>
                <a href="{% url 'admin:staff_staffmember_changelist' %}" class="db-action-btn">
                    <i class="ai-cyan fas fa-list"></i> All Staff</a>
                <a href="{% url 'admin:attendance_studentattendance_changelist' %}" class="db-action-btn">
                    <i class="ai-amber fas fa-calendar-check"></i> Attendance</a>
                <a href="{% url 'admin:examinations_examination_changelist' %}" class="db-action-btn">
                    <i class="ai-red fas fa-clipboard-list"></i> Exams</a>
                <a href="{% url 'admin:finance_payment_add' %}" class="db-action-btn">
                    <i class="ai-green fas fa-rupee-sign"></i> Add Payment</a>
                <a href="{% url 'admin:communication_notice_add' %}" class="db-action-btn">
                    <i class="ai-pink fas fa-bullhorn"></i> Post Notice</a>
            {% endif %}
            </div>
        </div>
    </div>

    {# RIGHT: Recent Activity + School Portals + System Info #}
    <div class="db-right">

        {# Recent Actions #}
        <div class="db-card">
            <div class="db-card-hdr">
                <h3><i class="fas fa-history"></i> Recent Activity</h3>
            </div>
            {% load log %}
            {% get_admin_log 12 as admin_log for_user user %}
            {% if not admin_log %}
            <div class="db-empty"><i class="fas fa-inbox" style="font-size:1.5rem;display:block;margin-bottom:0.5rem;"></i>No recent actions</div>
            {% else %}
            <ul class="act-list">
                {% for entry in admin_log %}
                <li class="act-item">
                    <div class="act-icon {% if entry.is_addition %}act-add{% elif entry.is_change %}act-chg{% else %}act-del{% endif %}">
                        <i class="fas {% if entry.is_addition %}fa-plus{% elif entry.is_change %}fa-pen{% else %}fa-trash{% endif %}"></i>
                    </div>
                    <div style="min-width:0;">
                        {% if entry.is_deletion or not entry.get_admin_url %}
                        <span class="act-obj" style="cursor:default;">{{ entry.object_repr|truncatechars:32 }}</span>
                        {% else %}
                        <a href="{{ entry.get_admin_url }}" class="act-obj">{{ entry.object_repr|truncatechars:32 }}</a>
                        {% endif %}
                        <div class="act-meta">
                            {% if entry.content_type %}{{ entry.content_type.name|capfirst }} Â· {% endif %}{{ entry.action_time|timesince }} ago
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        {# School Portals (master admin only) #}
        {% if is_master_admin and school_portals %}
        <div class="db-card">
            <div class="db-card-hdr">
                <h3><i class="fas fa-external-link-alt"></i> School Portals</h3>
            </div>
            <div class="portal-list">
                {% for portal in school_portals %}
                <a href="{{ portal.admin_url }}" class="portal-item" target="_blank">
                    <span class="portal-dot"></span>
                    <span class="portal-name">{{ portal.name }}</span>
                    <span class="portal-schema">{{ portal.schema }}</span>
                    <i class="fas fa-arrow-up-right-from-square portal-arrow"></i>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {# System info chip #}
        <div class="db-card">
            <div class="db-card-hdr"><h3><i class="fas fa-info-circle"></i> System</h3></div>
            <div style="padding:0.65rem 0.85rem;font-size:0.72rem;color:#64748b;line-height:1.9;">
                {% if is_master_admin %}
                <div>ğŸŒ <strong>campuskona.com</strong> Â· Public Schema</div>
                <div>ğŸ« {{ total_schools }} schools registered</div>
                <div>âœ… {{ active_schools }} currently active</div>
                {% else %}
                <div>ğŸ« <strong>{{ request.tenant.name }}</strong></div>
                <div>ğŸŒ {{ request.tenant.subdomain }}.campuskona.com</div>
                <div>ğŸ“‹ Schema: <code style="background:#f1f5f9;padding:0 4px;border-radius:3px;">{{ request.tenant.schema_name }}</code></div>
                <div>ğŸ“… Year: <strong>{{ current_academic_year|default:"Not set" }}</strong></div>
                {% endif %}
            </div>
        </div>

    </div>{# /db-right #}
</div>{# /db-body #}

{# â•â• FULL-WIDTH AVAILABLE MODULES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• #}
{% if app_list %}
<div class="db-modules-section">
    <div class="db-card-hdr" style="background:#fafafa;border:1px solid #e2e8f0;border-radius:10px 10px 0 0;">
        <h3><i class="fas fa-th-large"></i> Available Modules</h3>
        <span style="font-size:0.7rem;color:#94a3b8;">{{ app_list|length }} modules</span>
    </div>
    <div class="db-mod-grid">
        {% for app in app_list %}
        <div class="mod-app">
            <div class="mod-app-hdr">
                <a href="{{ app.app_url }}" class="mod-app-name">{{ app.name }}</a>
                <span class="mod-app-badge">{{ app.models|length }}</span>
            </div>
            <div class="mod-chips">
                {% for model in app.models %}
                    {% if model.admin_url %}
                    <a href="{{ model.admin_url }}" class="mod-chip" title="View {{ model.name }}">{{ model.name }}</a>
                    {% else %}
                    <span class="mod-chip" style="opacity:0.45;cursor:default;">{{ model.name }}</span>
                    {% endif %}
                    {% if model.add_url %}
                    <a href="{{ model.add_url }}" class="mod-chip-add" title="Add {{ model.name }}">+ Add</a>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

</div>{# /db-wrap #}
{% endblock %}

{% block sidebar %}
{% if is_master_admin %}{% else %}{{ block.super }}{% endif %}
{% endblock %}
