# Generated by Django 5.2.10 on 2026-02-11 07:48

import django.core.validators
import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='FinancialSnapshot',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('snapshot_date', models.DateField(db_index=True, unique=True)),
                ('platform_revenue_total', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('platform_revenue_mtd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('platform_revenue_ytd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('school_collections_total', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('school_collections_mtd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('partner_commissions_paid', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('partner_commissions_pending', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('investor_payouts_total', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('investor_payouts_ytd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('platform_expenses_total', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('platform_expenses_mtd', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('gross_profit', models.DecimalField(decimal_places=2, default=0, help_text='Platform Revenue - Platform Expenses', max_digits=12)),
                ('net_profit', models.DecimalField(decimal_places=2, default=0, help_text='Gross Profit - Commissions - Investor Payouts', max_digits=12)),
                ('calculated_at', models.DateTimeField(auto_now_add=True)),
                ('ledger_entries_count', models.IntegerField(default=0)),
                ('last_ledger_sequence', models.BigIntegerField(default=0)),
            ],
            options={
                'verbose_name': 'Financial Snapshot',
                'verbose_name_plural': 'Financial Snapshots',
                'db_table': 'public_financial_snapshots',
                'ordering': ['-snapshot_date'],
            },
        ),
        migrations.CreateModel(
            name='RoleBasedAccess',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('role', models.CharField(choices=[('SUPER_ADMIN', 'Super Administrator'), ('FINANCE_ADMIN', 'Finance Administrator'), ('INVESTOR', 'Investor'), ('AUDITOR', 'Auditor (Read-only)'), ('PARTNER', 'Partner'), ('SCHOOL_ADMIN', 'School Administrator')], max_length=20, unique=True)),
                ('can_view_platform_revenue', models.BooleanField(default=False)),
                ('can_view_school_collections', models.BooleanField(default=False)),
                ('can_view_partner_commissions', models.BooleanField(default=False)),
                ('can_view_investor_payouts', models.BooleanField(default=False)),
                ('can_view_expenses', models.BooleanField(default=False)),
                ('can_export_ledger', models.BooleanField(default=False)),
                ('can_view_audit_logs', models.BooleanField(default=False)),
                ('can_approve_payouts', models.BooleanField(default=False)),
                ('can_view_all_tenants', models.BooleanField(default=False)),
                ('restricted_to_own_data', models.BooleanField(default=True)),
                ('description', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Role-Based Access Control',
                'verbose_name_plural': 'Role-Based Access Controls',
                'db_table': 'public_role_based_access',
            },
        ),
        migrations.CreateModel(
            name='FinancialReport',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('report_type', models.CharField(choices=[('INVESTOR_DASHBOARD', 'Investor Dashboard Report'), ('LEDGER_EXPORT', 'Ledger Export'), ('PARTNER_SUMMARY', 'Partner Commission Summary'), ('REVENUE_BREAKDOWN', 'Revenue Breakdown'), ('EXPENSE_REPORT', 'Expense Report'), ('AUDIT_TRAIL', 'Audit Trail Report')], max_length=30)),
                ('report_format', models.CharField(choices=[('PDF', 'PDF'), ('EXCEL', 'Excel'), ('CSV', 'CSV')], max_length=10)),
                ('start_date', models.DateField()),
                ('end_date', models.DateField()),
                ('file', models.FileField(blank=True, null=True, upload_to='financial_reports/%Y/%m/')),
                ('file_size', models.BigIntegerField(default=0)),
                ('generated_at', models.DateTimeField(auto_now_add=True)),
                ('is_confidential', models.BooleanField(default=True)),
                ('download_count', models.IntegerField(default=0)),
                ('parameters', models.JSONField(default=dict, help_text='Report generation parameters')),
                ('generated_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='platform_financial_reports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Financial Report',
                'verbose_name_plural': 'Financial Reports',
                'db_table': 'public_financial_reports',
                'ordering': ['-generated_at'],
            },
        ),
        migrations.CreateModel(
            name='InvestorMetric',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('snapshot_date', models.DateField(db_index=True, unique=True)),
                ('calculated_at', models.DateTimeField(auto_now_add=True)),
                ('mrr', models.DecimalField(decimal_places=2, default=0, help_text='Monthly Recurring Revenue', max_digits=12)),
                ('arr', models.DecimalField(decimal_places=2, default=0, help_text='Annual Recurring Revenue (MRR * 12)', max_digits=12)),
                ('total_schools', models.IntegerField(default=0)),
                ('active_schools', models.IntegerField(default=0)),
                ('new_schools_this_month', models.IntegerField(default=0)),
                ('churned_schools_this_month', models.IntegerField(default=0)),
                ('churn_rate', models.DecimalField(decimal_places=2, default=0, help_text='Percentage of schools churned', max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('growth_rate', models.DecimalField(decimal_places=2, default=0, help_text='Month-over-month growth percentage', max_digits=5)),
                ('cac', models.DecimalField(decimal_places=2, default=0, help_text='Customer Acquisition Cost', max_digits=10)),
                ('ltv', models.DecimalField(decimal_places=2, default=0, help_text='Lifetime Value per school', max_digits=12)),
                ('ltv_cac_ratio', models.DecimalField(decimal_places=2, default=0, help_text='LTV:CAC ratio (should be > 3)', max_digits=5)),
                ('region_distribution', models.JSONField(default=dict, help_text="State-wise school count: {'Maharashtra': 40, 'Delhi': 30}")),
                ('tier_distribution', models.JSONField(default=dict, help_text='Subscription tier breakdown')),
            ],
            options={
                'verbose_name': 'Investor Metric Snapshot',
                'verbose_name_plural': 'Investor Metric Snapshots',
                'db_table': 'public_investor_metrics',
                'ordering': ['-snapshot_date'],
                'indexes': [models.Index(fields=['-snapshot_date'], name='public_inve_snapsho_341d61_idx'), models.Index(fields=['calculated_at'], name='public_inve_calcula_dab9b6_idx')],
            },
        ),
        migrations.CreateModel(
            name='InvestorProfile',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('investor_name', models.CharField(max_length=200)),
                ('investor_type', models.CharField(choices=[('ANGEL', 'Angel Investor'), ('VC', 'Venture Capital'), ('PE', 'Private Equity'), ('STRATEGIC', 'Strategic Investor'), ('ADVISOR', 'Advisor/Board Member')], max_length=20)),
                ('firm_name', models.CharField(blank=True, max_length=200)),
                ('investment_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12)),
                ('investment_date', models.DateField(blank=True, null=True)),
                ('equity_percentage', models.DecimalField(decimal_places=2, default=0, max_digits=5, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(100)])),
                ('dashboard_access', models.BooleanField(default=True)),
                ('financial_reports_access', models.BooleanField(default=True)),
                ('board_member', models.BooleanField(default=False)),
                ('email', models.EmailField(max_length=254)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='investor_profile', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Investor Profile',
                'verbose_name_plural': 'Investor Profiles',
                'db_table': 'public_investor_profiles',
                'ordering': ['-investment_date'],
            },
        ),
        migrations.CreateModel(
            name='MarketingSpend',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('month', models.DateField(db_index=True)),
                ('digital_marketing', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('events_conferences', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('content_marketing', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('partner_incentives', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('sales_team_cost', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('other_expenses', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('total_spend', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Marketing Spend',
                'verbose_name_plural': 'Marketing Spend Records',
                'db_table': 'public_marketing_spend',
                'ordering': ['-month'],
                'unique_together': {('month',)},
            },
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('action', models.CharField(choices=[('CREATE', 'Created'), ('UPDATE', 'Updated'), ('DELETE', 'Deleted'), ('VIEW', 'Viewed'), ('EXPORT', 'Exported'), ('APPROVE', 'Approved'), ('REJECT', 'Rejected')], max_length=10)),
                ('model_name', models.CharField(db_index=True, max_length=100)),
                ('object_id', models.CharField(max_length=100)),
                ('object_repr', models.CharField(max_length=200)),
                ('user_email', models.EmailField(max_length=254)),
                ('user_role', models.CharField(max_length=50)),
                ('timestamp', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.TextField(blank=True)),
                ('changes', models.JSONField(default=dict, help_text='Before/after values')),
                ('request_path', models.CharField(blank=True, max_length=500)),
                ('request_method', models.CharField(blank=True, max_length=10)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='platform_audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Audit Log Entry',
                'verbose_name_plural': 'Audit Log Entries',
                'db_table': 'public_audit_logs',
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['-timestamp'], name='public_audi_timesta_3293f3_idx'), models.Index(fields=['model_name', '-timestamp'], name='public_audi_model_n_75f0db_idx'), models.Index(fields=['user', '-timestamp'], name='public_audi_user_id_fd682a_idx')],
            },
        ),
        migrations.CreateModel(
            name='FinancialLedger',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('sequence_number', models.BigIntegerField(db_index=True, unique=True)),
                ('previous_hash', models.CharField(blank=True, max_length=64)),
                ('current_hash', models.CharField(db_index=True, max_length=64, unique=True)),
                ('transaction_type', models.CharField(choices=[('PLATFORM_SUBSCRIPTION', 'Platform Subscription Revenue'), ('PLATFORM_SETUP_FEE', 'Platform Setup Fee'), ('PLATFORM_ADDON', 'Platform Add-on Revenue'), ('SCHOOL_FEE_COLLECTION', 'School Fee Collection'), ('SCHOOL_OTHER_INCOME', 'School Other Income'), ('PARTNER_COMMISSION', 'Partner Commission Payout'), ('PARTNER_TDS', 'Partner TDS Deduction'), ('INVESTOR_DIVIDEND', 'Investor Dividend'), ('INVESTOR_RETURN', 'Investor Return on Investment'), ('PLATFORM_EXPENSE', 'Platform Operating Expense'), ('MARKETING_EXPENSE', 'Marketing Expense'), ('SALARY_EXPENSE', 'Salary Expense')], max_length=30)),
                ('category', models.CharField(choices=[('PLATFORM_REVENUE', 'Platform Revenue'), ('SCHOOL_COLLECTION', 'School Collection'), ('PARTNER_PAYOUT', 'Partner Payout'), ('INVESTOR_PAYOUT', 'Investor Payout'), ('PLATFORM_EXPENSE', 'Platform Expense')], db_index=True, max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=12)),
                ('currency', models.CharField(default='INR', max_length=3)),
                ('tenant_schema', models.CharField(blank=True, db_index=True, help_text='Tenant schema if applicable', max_length=63)),
                ('reference_type', models.CharField(blank=True, help_text="e.g., 'Subscription', 'Payout', 'Commission'", max_length=50)),
                ('reference_id', models.UUIDField(blank=True, help_text='ID of related object', null=True)),
                ('description', models.TextField()),
                ('metadata', models.JSONField(default=dict, help_text='Additional transaction data')),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('is_locked', models.BooleanField(default=True, help_text='Locked entries cannot be modified')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='ledger_entries_created', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Financial Ledger Entry',
                'verbose_name_plural': 'Financial Ledger Entries',
                'db_table': 'public_financial_ledger',
                'ordering': ['sequence_number'],
                'permissions': [('view_audit_trail', 'Can view audit trail'), ('export_ledger', 'Can export ledger data')],
                'indexes': [models.Index(fields=['sequence_number'], name='public_fina_sequenc_9b4e42_idx'), models.Index(fields=['category', '-created_at'], name='public_fina_categor_3d2d9c_idx'), models.Index(fields=['tenant_schema', '-created_at'], name='public_fina_tenant__966595_idx'), models.Index(fields=['transaction_type', '-created_at'], name='public_fina_transac_f7aa11_idx')],
            },
        ),
    ]
